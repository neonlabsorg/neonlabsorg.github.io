"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[4568],{3905:function(e,t,n){n.d(t,{Zo:function(){return u},kt:function(){return d}});var o=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},a=Object.keys(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=o.createContext({}),c=function(e){var t=o.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},u=function(e){var t=c(e.components);return o.createElement(s.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},m=o.forwardRef((function(e,t){var n=e.components,r=e.mdxType,a=e.originalType,s=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),m=c(n),d=r,f=m["".concat(s,".").concat(d)]||m[d]||p[d]||a;return n?o.createElement(f,l(l({ref:t},u),{},{components:n})):o.createElement(f,l({ref:t},u))}));function d(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=n.length,l=new Array(a);l[0]=m;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i.mdxType="string"==typeof e?e:r,l[1]=i;for(var c=2;c<a;c++)l[c]=n[c];return o.createElement.apply(null,l)}return o.createElement.apply(null,n)}m.displayName="MDXCreateElement"},7458:function(e,t,n){n.r(t),n.d(t,{assets:function(){return u},contentTitle:function(){return s},default:function(){return d},frontMatter:function(){return i},metadata:function(){return c},toc:function(){return p}});var o=n(7462),r=n(3366),a=(n(7294),n(3905)),l=["components"],i={title:"Setting up local Solana Cluster"},s=void 0,c={unversionedId:"developing/dev_environment/solana_cluster/cluster_installation",id:"developing/dev_environment/solana_cluster/cluster_installation",title:"Setting up local Solana Cluster",description:"This guide describes how to install, configure and test the local Solana cluster with Neon EVM on-board. It helps new developers to create their own environment and run Ethereum programs, wrapped into Neon EVM. All you need is to follow this guide step by step.",source:"@site/docs/developing/dev_environment/solana_cluster/cluster_installation.md",sourceDirName:"developing/dev_environment/solana_cluster",slug:"/developing/dev_environment/solana_cluster/cluster_installation",permalink:"/docs/developing/dev_environment/solana_cluster/cluster_installation",tags:[],version:"current",frontMatter:{title:"Setting up local Solana Cluster"},sidebar:"tutorialSidebar",previous:{title:"Connecting to the Neon Proxy",permalink:"/docs/developing/dev_environment/connect_to_solana_via_proxy"},next:{title:"Using Remix",permalink:"/docs/developing/deploy_facilities/using_remix"}},u={},p=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Setting up the Solana Cluster",id:"setting-up-the-solana-cluster",level:2},{value:"Logs",id:"logs",level:2},{value:"Remix and Metamask with Neon EVM",id:"remix-and-metamask-with-neon-evm",level:2},{value:"Truffle suite with Neon EVM",id:"truffle-suite-with-neon-evm",level:2},{value:"Common truffle settings",id:"common-truffle-settings",level:3},{value:"Contract creating",id:"contract-creating",level:3},{value:"Testing",id:"testing",level:3},{value:"Possible problems",id:"possible-problems",level:3}],m={toc:p};function d(e){var t=e.components,i=(0,r.Z)(e,l);return(0,a.kt)("wrapper",(0,o.Z)({},m,i,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,(0,a.kt)("em",{parentName:"p"},"This guide describes how to install, configure and test the local Solana cluster with Neon EVM on-board. It helps new developers to create their own environment and run Ethereum programs, wrapped into Neon EVM. All you need is to follow this guide step by step.")),(0,a.kt)("p",null,"The ",(0,a.kt)("a",{parentName:"p",href:"https://neon-labs.org/"},"Neon EVM")," is a solution that performs transaction execution outside layer 1. The development process can be run on any modern Linux or Mac system, though this document is based on Ubuntu 20.04 experience."),(0,a.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://docs.docker.com/engine/install/ubuntu/"},"Docker")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://docs.docker.com/compose/install/"},"Docker-compose")),(0,a.kt)("li",{parentName:"ul"},"A Chromium-based browser for ",(0,a.kt)("a",{parentName:"li",href:"https://metamask.io/"},"Metamask")," and ",(0,a.kt)("a",{parentName:"li",href:"https://remix.ethereum.org/"},"Remix")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://www.w3schools.com/nodejs/nodejs_npm.asp"},"Node.js/npm"))),(0,a.kt)("h2",{id:"setting-up-the-solana-cluster"},"Setting up the Solana Cluster"),(0,a.kt)("p",null,"All you need to have the Solana Cluster with Neon EVM on board is to deploy multi-container environment with ",(0,a.kt)("a",{parentName:"p",href:"docker-compose-local.yml"},"the following compose file")," and of course you should have ",(0,a.kt)("inlineCode",{parentName:"p"},"docker")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"docker-container")," apps installed."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"$ docker-compose -f docker-compose-local.yml up -d\nCreating solana   ... done\nCreating postgres ... done\nCreating evm_loader ... done\nCreating proxy      ... done\n$ ls ./solana_state\nledger  run\n")),(0,a.kt)("p",null,"Once you deploy the environment you'll have the Solana RPC endpoint working from the docker container at the 9090 port.\nThe folder named \"solana_state\" will be created as well, it contains the solana's ledger to keep the state over restarts. If you need to reset the ledger just remove this folder and it'll be recreated after next-time running docker-compose."),(0,a.kt)("h2",{id:"logs"},"Logs"),(0,a.kt)("p",null,"To look for events or errors that you can be interested in just run the ",(0,a.kt)("inlineCode",{parentName:"p"},"docker logs")," for either ",(0,a.kt)("inlineCode",{parentName:"p"},"solana")," or ",(0,a.kt)("inlineCode",{parentName:"p"},"proxy")," container:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},'$ docker logs -f solana 2>&1 | grep -v "Program Vote111111111111111111111111111111111111111"\n$ docker logs -f proxy\n')),(0,a.kt)("h2",{id:"remix-and-metamask-with-neon-evm"},"Remix and Metamask with Neon EVM"),(0,a.kt)("p",null,'Setup the "Metamask" Chromium extension to connect to the proxy via Custom RPC at ',(0,a.kt)("inlineCode",{parentName:"p"},"http://localhost:9090/solana"),". The following image describes how to set up the local Solana connection:  "),(0,a.kt)("div",{class:"neon-img-box-300",style:{textAlign:"center"}},(0,a.kt)("p",null,(0,a.kt)("img",{src:n(320).Z,width:"300",height:"402"}))),(0,a.kt)("p",null,"Worth remarking is that once you create or import new account in metamask there some NEONs will be airdropped onto it."),(0,a.kt)("p",null,"Open Remix (also in Chromium) and select ",(0,a.kt)("inlineCode",{parentName:"p"},"Injected Web3")," environment. You can deploy EVM-wrapped smart contracts on Solana and invoke instructions:  "),(0,a.kt)("div",{class:"neon-img-box-300",style:{textAlign:"center"}},(0,a.kt)("p",null,(0,a.kt)("img",{src:n(9042).Z,width:"300",height:"455"}))),(0,a.kt)("h2",{id:"truffle-suite-with-neon-evm"},"Truffle suite with Neon EVM"),(0,a.kt)("p",null,"Truffle is a popular platform to deploy and test solidity programs. This section is to check Neon EVM and truffle suite compatibility."),(0,a.kt)("p",null,"In the new terminal, create a truffle project and deploy contracts into EVM:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"$ sudo npm install -g truffle\n$ mkdir myproject && cd myproject\n$ truffle init\n$ npm install web3 @truffle/hdwallet-provider\n")),(0,a.kt)("h3",{id:"common-truffle-settings"},"Common truffle settings"),(0,a.kt)("p",null,"Put your ",(0,a.kt)("inlineCode",{parentName:"p"},"truffle-config.js")," into the truffle root:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},'$ echo \'const Web3 = require("web3");\n\nconst Web3eth = require("web3-eth");\nconst HDWalletProvider = require("@truffle/hdwallet-provider");\n\nconst web3eth = new Web3eth();\nconst accs = Array.from(Array(10), (_, x) => web3eth.accounts.create());\nconst privateKeys = accs.map((account) => account.privateKey);\n\nmodule.exports = {\n  networks: {\n    solana: {\n      provider: new HDWalletProvider(privateKeys, "http://127.0.0.1:9090/solana"),\n      from: accs[0].publicKey,\n      network_id: "111",\n      gas: 3000000,\n      gasPrice: 1000000000,\n    }\n  },\n\n  compilers: {\n    solc: {\n      version: "0.8.9"\n    }\n  }\n};\' > truffle-config.js\n')),(0,a.kt)("h3",{id:"contract-creating"},"Contract creating"),(0,a.kt)("p",null,"Create a trivial contract at ",(0,a.kt)("inlineCode",{parentName:"p"},"contracts/Storage.sol"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"$ echo '// SPDX-License-Identifier: GPL-3.0\n\npragma solidity >=0.7.0 <0.9.0;\n\ncontract Storage {\n    uint256 number;\n\n    function put(uint256 num) public {\n        number = num;\n    }\n\n    function get() public view returns (uint256) {\n        return number;\n    }\n}' > contracts/Storage.sol\n")),(0,a.kt)("h3",{id:"testing"},"Testing"),(0,a.kt)("p",null,"You can now start testing ",(0,a.kt)("inlineCode",{parentName:"p"},"Storage")," invocations with truffle facility:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},'$ echo \'const Storage = artifacts.require("Storage");\n\ncontract("Storage", (accounts) => {\n    let storage;\n\n    beforeEach(async () => {\n        storage = await Storage.new();\n    });\n\n    it("should store a value", async () => {\n        const setResult = await storage.put(248);\n        assert.equal(setResult.receipt.status, true);\n        const value = await storage.get();\n        assert.equal(value, 248);\n    })\n})\' > test/Storage.test.js\n\n$ truffle test test/Storage.test.js --network solana\n')),(0,a.kt)("h3",{id:"possible-problems"},"Possible problems"),(0,a.kt)("p",null,"If for some reasons you remove the Solana container and run it again then all related accounts, stored in foreign systems, get invalid from that moment. That's why you need to re-run proxy container and reset the state of Metamask and truffle as well, to make all relations consistent."),(0,a.kt)("p",null,"To reset the metamask state, follow the steps ",(0,a.kt)("inlineCode",{parentName:"p"},"Settings"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"Advanced"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"Reset Account"),", ."),(0,a.kt)("p",null,"The truffle state can be reset by redeploying in the following way:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"$ truffle compile --network solana --reset\n")),(0,a.kt)("hr",null),(0,a.kt)("p",null,(0,a.kt)("em",{parentName:"p"},"Welcome to deploy your solidity programs on ",(0,a.kt)("a",{parentName:"em",href:"https://solana.com"},"Solana")," driven ",(0,a.kt)("a",{parentName:"em",href:"https://neon-labs.org/"},"Neon EVM")),"."))}d.isMDXComponent=!0},320:function(e,t,n){t.Z=n.p+"assets/images/cluster-install-1-2a934237b77806464af491c468c92f13.png"},9042:function(e,t,n){t.Z=n.p+"assets/images/cluster-install-2-0e37ce12c2afc407dcdd02b669044898.png"}}]);